<!doctype html>
<html>
	<head>
		<title>Should I rent or buy?</title>
		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
		<!-- Optional theme -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
	</head>

	<body>
		<div class="container-fluid">
			<div class="row" id="financial-variables">
				<form role="form" data-toggle="validator" id="input-form">
				<div class="form-group col-xs-12 col-sm-6">
					<label for="purchase-price">Purchase price: </label>
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<input type="number" min="0" step="any" class="form-control" id="purchase-price" value="500000" required>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="down-payment">Down Payment: </label>
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<input type="number" min="0" step="any" class="form-control" id="down-payment" value="100000" required>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="mortgage-rate">Mortgage Interest Rate: </label>
					<div class="input-group">
						<input type="number" min="0" step="any" class="form-control" id="mortgage-rate" value="4.5" required>
						<span class="input-group-addon">%</span>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="mortgage-term">Mortgage Term (years): </label>
					<select class="form-control" id="mortgage-term">
    					<option value="15">15</option>
    					<option value="20">20</option>
    					<option value="30" selected="selected">30</option>
					</select>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="property-tax-rate">Property Tax Rate: </label>
					<div class="input-group">
						<input type="number" min="0" step="any" class="form-control" id="property-tax-rate" value="1.25" required>
						<span class="input-group-addon">%</span>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="monthly-hoa">Monthly HOA fees: </label>
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<input type="number" min="0" step="any" class="form-control" id="monthly-hoa" value="250" required>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="annual-insurance">Annual Insurance: </label>
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<input type="number" min="0" step="any" class="form-control" id="annual-insurance" value="230" required>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="appreciation-rate">Estimated Annual Appreciation Rate: </label>
					<div class="input-group">
						<input type="number" min="0" step="any" class="form-control" id="appreciation-rate" value="2" required>
						<span class="input-group-addon">%</span>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="annual-maintenance">Annual maintenance: </label>
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<input type="number" min="0" step="any" class="form-control" id="annual-maintenance" value="300" required>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="inflation-rate">Annual Inflation Rate: </label>
					<div class="input-group">
						<input type="number" min="0" step="any" class="form-control" id="inflation-rate" value="2" required>
						<span class="input-group-addon">%</span>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="tax-rate">Marginal Tax Rate: </label>
					<div class="input-group">
						<input type="number" min="0" step="any" class="form-control" id="tax-rate" value="28" required>
						<span class="input-group-addon">%</span>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="rent">Monthly Rent: </label>
					<div class="input-group">
						<span class="input-group-addon">$</span>
						<input type="number" min="0" step="any" class="form-control" id="rent" value="1700"required>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="rent-inflation">Annual Rent Inflation: </label>
					<div class="input-group">
						<input type="number" min="0" step="any" class="form-control" id="rent-inflation" value="3" required>
						<span class="input-group-addon">%</span>
					</div>
				</div>
				<div class="form-group col-xs-12 col-sm-6">
					<label for="investment-rate">Investment Return Rate (after taxes): </label>
					<div class="input-group">
						<input type="number" min="0" class="form-control" id="investment-rate" value="5" required>
						<span class="input-group-addon">%</span>
					</div>
				</div>
				<div class="col-xs-1">
					<input class="btn btn-default" type="submit" value="Calculate">
				</div>
			</form>
			</div>
			<div class="row" id="results-section" style="display: none;">
				<div class="col-xs-12">
					<div class="jumbotron">
						<p id="advice-text"></p>
					</div>
				</div>
				<div class="col-xs-12 col-sm-6">
					<canvas id="chart" width="200" height="200"></canvas>
				</div>
				<div class="col-xs-12 col-sm-6">
					<h1>Some details here</h1>
				</div>
				<div class="col-xs-12">
					<button class="btn btn-default" id="show-form">Edit Options</button>
				</div>
			</div>

		</div>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<!-- Latest compiled and minified JavaScript -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.0.1/Chart.js"></script>
		<script src="js/lib/validator.min.js"></script>
		<script src="js/src/FixedMortgageCalculator.js"></script>
		<script src="js/src/RentOrBuyCalculator.js"></script>
		<script>
		$(document).ready(function() {
			var calculator = new RentOrBuyCalculator();

			function calculate() {
				calculator.purchasePrice = Number($('#purchase-price').val());
				calculator.downPayment = Number($('#down-payment').val());
				calculator.mortgageRate = $('#mortgage-rate').val() / 100;
				calculator.mortgageTerm = Number($('#mortgage-term').val());
				calculator.propertyTaxRate = $('#property-tax-rate').val() / 100;
				calculator.monthlyHOAFees = Number($('#monthly-hoa').val());
				calculator.annualInsurance = Number($('#annual-insurance').val());
				calculator.annualAppreciation = $('#appreciation-rate').val() / 100;
				calculator.annualMaintenance = Number($('#annual-maintenance').val());
				calculator.inflationRate = $('#inflation-rate').val() / 100;
				calculator.marginalTaxRate = $('#tax-rate').val() / 100;
				calculator.monthlyRent = Number($('#rent').val());
				calculator.annualRentInflation = $('#rent-inflation').val() / 100;
				calculator.investmentReturnRate = $('#investment-rate').val() / 100;
				calculator.setup();
				var monthsTillWorthOwning = calculator.monthsTillWorthOwning();
				var adviceText;
				if (monthsTillWorthOwning == -1) {
					adviceText = "You are better off renting your home.";
				} else {
					var years = parseInt(monthsTillWorthOwning / 12);
					var months = monthsTillWorthOwning % 12;
					adviceText = "It is worth buying your home if you live there for at least " + years + " years";
					if (months == 0) {
						adviceText += ".";
					} else {
						adviceText += " and " + months + " months.";
					}
				}
				$('#advice-text').text(adviceText);
				renderChart();
			}

			function renderChart() {
				var labels = [];
				var cashWhenRenting = [];
				var cashAfterSelling = [];
				for (var year = 0; year <= calculator.mortgageTerm; year++) {
					labels.push(year.toString());
					cashWhenRenting.push(Math.round(calculator.cashWhenRenting(year * 12)));
					cashAfterSelling.push(Math.round(calculator.cashAfterSellingHome(year * 12)));
				}
				
				var data = {
					labels: labels,
					datasets: [
						{
							label: "Savings when renting",
							fill: true,
							borderColor: "rgba(75,192,192,1)",
							backgroundColor: "rgba(75,192,192,0.4)",
							pointBorderColor: "rgba(75,192,192,1)",
							pointBackgroundColor: "#fff",
							pointBorderWidth: 1,
            				pointHoverRadius: 5,
            				pointHoverBackgroundColor: "rgba(75,192,192,1)",
            				pointHoverBorderColor: "rgba(220,220,220,1)",
							data: cashWhenRenting
						},
						{
							label: "Savings after selling home",
							fill: true,
							borderColor: "rgba(255,205,86,1)",
							backgroundColor: "rgba(255,205,86,0.4)",
							pointBorderColor: "rgba(255,205,86,1)",
            				pointBackgroundColor: "#fff",
            				pointBorderWidth: 1,
            				pointHoverRadius: 5,
            				pointHoverBackgroundColor: "rgba(255,205,86,1)",
            				pointHoverBorderColor: "rgba(255,205,86,1)",
							data: cashAfterSelling
						}
					]
				};
				var options = {
					responsive: true,
					tooltips: {
						callbacks: {
                        	title: function(tooltipItems, data) {
                        		return "Year " + tooltipItems[0].xLabel;
                        	},
							label: function(tooltipItem, data) {
								return data.datasets[tooltipItem.datasetIndex].label + ": " + tooltipItem.yLabel.toFinancial()
							}
						}
					},
					scales: {
            			yAxes: [{
            				display: true,
                			ticks: {
                    			beginAtZero:false,
                    			userCallback: function(value, index, values) {
                    				return value.toFinancial()
                    			}
                			}
            			}],
            			xAxes: [{
            				display: true,
            				scaleLabel: {
            					display: true,
            					labelString: 'Year'
            				},
                			ticks: {
                    			beginAtZero:true
                			}
            			}]
        			}
        		};
				var canvas = $("#chart");
				var chart = new Chart(canvas, {
    				type: 'line',
    				data: data,
    				options: options
				});
			}

			Number.prototype.toFinancial = function() {
				return "$" + this.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
			};

    		$('#input-form').validator().on('submit', function (event) {
    			if (!event.isDefaultPrevented()) {
    				calculate();
    				$('#financial-variables').hide();
    				$('#results-section').show();
    				event.preventDefault();
    			}
    		});
    		$('#show-form').click(function() {
    			$('#financial-variables').show();
    			$('#results-section').hide();
    		});
    	});
        </script>
	</body>
</html>